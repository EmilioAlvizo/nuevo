<div class="contenedor">
  <p-toolbar class="mb-4">
    <ng-template #start>
      <p-button label="Nuevo" icon="pi pi-plus" class="me-2" (onClick)="openNew()" />
      <p-button
        severity="danger"
        label="Eliminar Seleccionados"
        icon="pi pi-trash"
        outlined
        (onClick)="deleteSelectedArchivos()"
        [disabled]="!selectedArchivos || !selectedArchivos.length"
      />
    </ng-template>
    <ng-template #end>
      <p-button
        label="Exportar"
        icon="pi pi-upload"
        severity="secondary"
        (onClick)="exportCSV($event)"
      />
    </ng-template>
  </p-toolbar>

  <p-table
    #dt
    [value]="Archivos_municipio"
    [rows]="10"
    [paginator]="true"
    [rowsPerPageOptions]="[10, 25, 50]"
    [globalFilterFields]="[
      'nombre_archivo',
      'nombre_municipio',
      'tipo_archivo',
      'categoria_archivo',
      'subcategoria_archivo',
      'estatus_archivo'
    ]"
    [tableStyle]="{ 'min-width': '90rem' }"
    [(selection)]="selectedArchivos"
    [rowHover]="true"
    dataKey="id_archivo"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} archivos"
    [showCurrentPageReport]="true"
    [loading]="loading"
    (sortFunction)="customSort($event)"
    [customSort]="true"
  >
    <ng-template #caption>
      <div class="d-flex align-items-center justify-content-between">
        <h5 class="m-0">Gestión de Archivos Municipales</h5>
        <div class="d-flex gap-2">
          <p-button
            label="Limpiar Filtros"
            [outlined]="true"
            icon="pi pi-filter-slash"
            (click)="clear(dt)"
          />
          <p-iconfield iconPosition="left">
            <p-inputicon>
              <i class="pi pi-search"></i>
            </p-inputicon>
            <input
              pInputText
              type="text"
              (input)="dt.filterGlobal($event.target.value, 'contains')"
              placeholder="Buscar archivos..."
            />
          </p-iconfield>
        </div>
      </div>
    </ng-template>

    <ng-template #header>
      <tr>
        <!-- <th style="width: 3rem">
          <p-tableHeaderCheckbox />
        </th> -->
        <th pSortableColumn="nombre_archivo" style="min-width: 16rem">
          <div class="d-flex align-items-center justify-content-between">
            Nombre Archivo
            <p-sortIcon field="nombre_archivo" />
            <p-columnFilter type="text" field="nombre_archivo" display="menu" />
          </div>
        </th>
        <th pSortableColumn="nombre_municipio" style="min-width: 14rem">
          <div class="d-flex align-items-center justify-content-between">
            Municipio
            <p-sortIcon field="nombre_municipio" />
            <p-columnFilter type="text" field="nombre_municipio" display="menu" />
          </div>
        </th>
        <th pSortableColumn="tipo_archivo" style="min-width: 10rem">
          <div class="d-flex align-items-center justify-content-between">
            Tipo
            <p-sortIcon field="tipo_archivo" />
            <p-columnFilter field="tipo_archivo" matchMode="equals" display="menu">
              <ng-template #filter let-value let-filter="filterCallback">
                <p-select
                  [ngModel]="value"
                  [options]="tiposArchivo"
                  (onChange)="filter($event.value)"
                  placeholder="Seleccionar"
                  class="w-100"
                />
              </ng-template>
            </p-columnFilter>
          </div>
        </th>
        <th pSortableColumn="categoria_archivo" style="min-width: 12rem">
          <div class="d-flex align-items-center justify-content-between">
            Categoría
            <p-sortIcon field="categoria_archivo" />
            <p-columnFilter field="categoria_archivo" matchMode="equals" display="menu">
              <ng-template #filter let-value let-filter="filterCallback">
                <p-select
                  [ngModel]="value"
                  [options]="categorias"
                  (onChange)="filter($event.value)"
                  placeholder="Seleccionar"
                  class="w-100"
                />
              </ng-template>
            </p-columnFilter>
          </div>
        </th>
        <th pSortableColumn="subcategoria_archivo" style="min-width: 12rem">
          <div class="d-flex align-items-center justify-content-between">
            Subcategoría
            <p-sortIcon field="subcategoria_archivo" />
            <p-columnFilter type="text" field="subcategoria_archivo" display="menu" />
          </div>
        </th>
        <th pSortableColumn="fecha_archivo" style="min-width: 10rem">
          <div class="d-flex align-items-center justify-content-between">
            Fecha Archivo
            <p-sortIcon field="fecha_archivo" />
            <p-columnFilter type="date" field="fecha_archivo" display="menu" />
          </div>
        </th>
        <th pSortableColumn="fecha_modificacion" style="min-width: 10rem">
          <div class="d-flex align-items-center justify-content-between">
            Modificación
            <p-sortIcon field="fecha_modificacion" />
            <p-columnFilter type="date" field="fecha_modificacion" display="menu" />
          </div>
        </th>
        <th pSortableColumn="estatus_archivo" style="min-width: 10rem">
          <div class="d-flex align-items-center justify-content-between">
            Estatus
            <p-sortIcon field="estatus_archivo" />
            <p-columnFilter field="estatus_archivo" matchMode="equals" display="menu">
              <ng-template #filter let-value let-filter="filterCallback">
                <p-select
                  [ngModel]="value"
                  [options]="estatusOptions"
                  (onChange)="filter($event.value)"
                  placeholder="Seleccionar"
                  class="w-100"
                  optionLabel="label"
                  optionValue="value"
                >
                  <ng-template let-option #item>
                    <p-tag [value]="option.label" [severity]="getSeverity(option.value)" />
                  </ng-template>
                </p-select>
              </ng-template>
            </p-columnFilter>
          </div>
        </th>
        <th style="min-width: 14rem">Acciones</th>
      </tr>
    </ng-template>

    <ng-template #body let-archivo>
      <tr>
        <!-- <td style="width: 3rem">
          <p-tableCheckbox [value]="archivo" />
        </td> -->
        <td>
          <div class="d-flex align-items-center gap-2">
            <i class="pi pi-file fs-5" [ngClass]="getFileIcon(archivo.tipo_archivo)"></i>
            <span class="fw-medium">{{ archivo.nombre_archivo }}</span>
          </div>
          <small class="text-muted d-block mt-1" *ngIf="archivo.palabras_clave">
            <i class="pi pi-tag small"></i> {{ archivo.palabras_clave }}
          </small>
        </td>
        <td>{{ archivo.nombre_municipio }}</td>
        <td>
          <p-tag [value]="archivo.tipo_archivo" severity="info" />
        </td>
        <td>{{ archivo.categoria_archivo }}</td>
        <td>{{ archivo.subcategoria_archivo }}</td>
        <td>{{ archivo.fecha_archivo | date : 'dd/MM/yyyy' }}</td>
        <td>{{ archivo.fecha_modificacion | date : 'dd/MM/yyyy HH:mm' }}</td>
        <td>
          <p-tag
            [value]="archivo.estatus_archivo"
            [severity]="getSeverity(archivo.estatus_archivo)"
          />
        </td>
        <td>
          <div class="d-flex gap-2">
            <p-button
              icon="pi pi-download"
              [rounded]="true"
              [outlined]="true"
              severity="success"
              pTooltip="Descargar"
              tooltipPosition="top"
              (click)="downloadArchivo(archivo)"
            />
            <p-button
              icon="pi pi-pencil"
              [rounded]="true"
              [outlined]="true"
              pTooltip="Editar"
              tooltipPosition="top"
              (click)="editArchivo(archivo)"
            />
            <p-button
              icon="pi pi-trash"
              severity="danger"
              [rounded]="true"
              [outlined]="true"
              pTooltip="Eliminar"
              tooltipPosition="top"
              (click)="deleteArchivo(archivo)"
            />
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="10" class="text-center py-4">
          <i class="pi pi-inbox display-4 text-muted mb-3 d-block"></i>
          <p class="text-muted">No se encontraron archivos.</p>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-confirmDialog [style]="{ width: '450px' }" />
  <!-- <p-table [value]="Archivos_municipio" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template #header>
      <tr>
        <th>Id</th>
        <th>Nombre</th>
        <th>Fecha</th>
        <th>Categoria</th>
      </tr>
    </ng-template>
    <ng-template #body let-datos>
      <tr>
        <td>{{ datos.id_archivo }}</td>
        <td>{{ datos.nombre_archivo }}</td>
        <td>{{ datos.fecha_archivo }}</td>
        <td>{{ datos.categoria_archivo }}</td>
      </tr>
    </ng-template>
  </p-table> -->
</div>
